## 四、系统设计

### 1、前端交互

TODO: Describe how our website functions

#### 基于参赛者的视角

- 注册、登录、身份验证（可以使用H5标题，也即输入#####）
- 竞赛、用户搜索

##### 竞赛全流程参与：浏览、报名、提交作品、查看成绩、证书验证

![image-20201226153616012](\images\frontend_contest_detailed_page.png)

如上图所示，当一个参赛者进入赛事页面时，会看到竞赛的宣传图片、标题、详细介绍、举办方信息与竞赛当前的状态。其中，竞赛的详细介绍可根据举办者的需求，自定义上传文本或图片，以便充分展示竞赛的内容。除此之外，在页面下方，我们还增加了“竞赛公告”栏目。如果举办者希望对竞赛的内容进行补充通知、或者是发布相关资料，都可以通过“竞赛公告”来实现。参赛者将可以看到举办者发布的通知，并前往其中的链接或下载相关附件。

![image-20201226155454849](\images\frontend_contest_notice.png)

如果一个用户决定报名，可以点击右上方的按钮进行报名操作。系统将自动根据竞赛类型（个人赛、团队赛）显示不同的配置供用户选择。比如，在团队赛中，用户将有机会填写团队名、团队描述和选择自己的队友。我们实现了一个动态更新的搜索框，使得用户可以更容易地找到自己的队友。当选好队友后，用户可以通过输入队友提供的组队码快捷组队。组队码可以在各自的用户中心里查看获得。

![image-20201226160912505](\images\frontend_contest_register.png)

报名完毕后，根据举办者的设置，用户的信息可能需要先通过竞赛举办者的审核。审核通过后，参赛者就可以在竞赛作品提交截止日期到来前随意地上传、下载、修改或删除自己的作品文件。对于团队竞赛，用户还可以查看团队信息。

<img src="\images\frontend_contest_submitworks.png" alt="image-20201226161404615"  />

![image-20201226162056389](\images\frontend_contest_groupinfo.png)

当用户提交完作品后，竞赛举办者将可以对其作品进行打分和评奖。用户可以在奖项发布后查看自己的奖项。

![image-20201226163351097](\images\frontend_checkawards.png)

根据需要，用户可以查看证书或者在线查看所获奖项的详细信息。其中，证书将包含二维码，使得其他人无需注册和登录，也可快捷通过扫码的方式在线验证证书的真实性，避免了伪造的可能。下图为一个示例证书（其中的二维码是有效的，可供扫描）：

![frontend_sample_certificate](\images\frontend_sample_certificate.png)

至此，参赛者参与竞赛的全流程就已经结束。

##### 私信与系统通知

我们还提供了私信与系统通知功能。私信功能使得用户方便地与队友甚至是竞赛发布者沟通、交流。而系统通知则可以提示用户一些关键信息。比如审核通过/未通过，竞赛创建成功/失败等。

下图是两个典型的私信场景：左图为用户查看其他用户的个人中心时所能看到的场景，而右图是用户自己的消息中心。值得注意的是，用户头像右上角的红色圆点表明了是否有未读消息，以便用户快速了解自己是否有未读消息。![image-20201226164920833](\images\frontend_message_center.png)

此外，用户还可以从自己的消息中心中查看由系统自动发出的通知信息：

![image-20201226165133446](\images\frontend_system_notice.png)

- 用户中心

#### 基于竞赛举办者的视角

- 竞赛举办者的身份验证、账户注册
- 发布竞赛、管理竞赛（公告、审核用户、修改竞赛等）

##### 成绩与获奖信息发布

竞赛举办者可以在管理界面查看每个竞赛中用户的作品提交情况、为其打分并设置奖项。我们为竞赛举办者提供了多种灵活的机制使其更容易地对竞赛进行管理。下图即为成绩与奖项管理页面：

![image-20201226173111290](\images\frontend_sponsor_scorecheck.png)

如图所示，评分页面中可以显示每个用户的作品提交状况。对于已提交作品的用户，竞赛举办者可以从左侧勾选部分用户或者直接下载全部用户的作品。

在评阅完每个用户的作品后，举办方将可以给每个参赛者进行打分和评奖。打分和评奖有多种方式：1. 直接点击页面中的表项，即可进行快捷修改；2. 下载打分表（表格文件），自行批量编辑后再上传，由系统完成解析和同步；3. 使用“批量填写奖项”功能，可以快捷为分数在某个区间段的用户设置主要奖项。

![image-20201226173603493](\images\frontend_set_single_score.png)

<img src="\images\frontend_set_awards_in_batch.png" alt="image-20201226173638597" style="zoom: 50%;" />

在正式发布之前，举办者对竞赛成绩或奖项所做的任何修改都只会被暂存。此时也不会为参赛者生成证书。只有当举办者确认最终发布成绩与奖项后，获奖证书才能够被下载和验证有效性。由于最终发布成绩后无法再进行修改，系统将要求赛事举办者确认最终发布成绩的操作：

![image-20201226174114377](\images\frontend_publish_award.png)

成绩发布后，参赛者就能在前面的竞赛详情页面中看到自己的奖项并下载证书，在线验证证书功能也将被激活。而竞赛举办者也可以根据自己的需要，批量导出获奖证书，以便印刷或发放。

![image-20201226174454654](\images\frontend_get_certificates.png)

##### 私信与系统通知

竞赛举办者也有自己的消息中心，其功能与参赛者的基本一致。只是提示消息的类型和内容有所不同。故此处不再赘述。



##### 线下报名（基于小程序）

除了线上举办的竞赛，我们还支持为线下赛事提供便捷的管理服务。一个竞赛举办方只需要按照线上赛事的创建流程进行创建即可，无需任何额外的操作，参赛者仍可以按照正常的流程进行报名，不受影响。如果赛事将在线下举办，举办方可以要求参赛者现场登录微信小程序，出示参赛者的二维码，举办者只需要使用自己的小程序扫码，就可以方便地在线下将参赛者添加到竞赛中来。而且，通过线下方式添加的参赛者也可以被正常地评分、评奖，从而使得举办者的操作有了更多的灵活性。即便竞赛不是线下的，举办者仍然可以使用微信小程序让报名过程变得更为灵活和易于管理。下图中，左图为竞赛举办方登陆小程序后的界面，右图为参赛者登录小程序后的界面。

![frontend_offline_register](\images\frontend_offline_register.png)







#### 基于网站管理员的视角

- 人工审核用户报名
- 竞赛发布审核
- 创建和管理竞赛举办者的邀请码

#### 基于其他用户的视角

- 游客：浏览竞赛（小程序、网站主页）、查看部分公告

##### 非注册用户（如高校、用人单位等）：扫码验证获奖证书的有效性

为了方便查询获奖证书的有效性，我们在小程序和网页端提供了多种便捷的证书查询方式，即便是未注册用户，也只需要拿出手机扫一扫，就可以快捷完成查询操作。下图以微信小程序端为例，演示了扫码的方式。（网页端只需要使用任意扫码软件进行扫描即可）

![frontend_miniprogram_certificate_verification](\images\frontend_miniprogram_certificate_verification.png)



### 4、 接口规范

本次软件项目开发中，采用了前后端分离的RESTful API接口设计规范。由于软件项目主要采用增量模型开发，因此随着开发过程的推进，现有API的设计可能会发生变化，或者新的API将被引入。我们采用腾讯文档来管理可能不断发生变化的API，使得API的每次修订和历史版本都能溯源。API文档链接为：https://docs.qq.com/doc/DZUtNR1lJckJYd2Ro。

由于对API的详细描述可在上述文档中找到，此处不再对每个API的具体功能进行介绍。而是说明API的总体设计思路。

在本次软件项目中，我们首先约定了通用的请求与返回值类型。比如，对于任意需要用户登录状态的API，请求中都应该包含“jwt”字段。如果请求的操作成功，则总是应该包含'message'字段表明成功信息；如果请求的操作失败，则应该包含'error'字段进一步表明错误的类型。正如API文档中所示，我们对一些常见的错误约定了通用的描述方法，比如{'error':'authority'}将表示用户的身份与其要进行的操作不符（如参赛者不能发布竞赛）；又如{'error':'login'}表明用户的登录信息已过期或用户未登录。对常用参数和返回值进行约定可使得我们后续对API的修改只需关注在API的核心功能上，降低了管理API的成本，提高了开发效率。

更具体地，按照API的功能和所需的权限划分，API的类型可以分如下四类：

- 公开信息查询接口

  这类接口的作用是提供一些公开程度较高的信息，为用户提供便捷的服务，因此无需身份验证。典型API包括竞赛查询、获奖证书有效性的验证等功能。这类API通常只需要一些搜索或查询的参数，后端在收到这些参数后，就会从数据库中查找相关信息并返回。

- 涉及隐私的信息查询接口

  这类接口的作用仍然是查询信息，但是，它们通常与个人账号或个人实名信息相关联，因此不能被任意查询与访问。解决的方案是在发送标准的查询参数的基础上，额外发送jwt作为验证个人身份的凭证。

- 修改、提交数据接口

  这部分的接口通常需要操作数据库，其具体功能因业务场景而异，如：竞赛创建、公告发布、成绩上传、竞赛报名等等。显然，这些操作都需要确认是用户本人在进行操作，以避免造成不必要的损失。故这类接口均需要用户发送自己的身份凭证。对于部分场景，用户提交的数据可能包含敏感信息（如学信网验证码、身份证号等），我们还采用了HTTPS、信息脱敏或仅发送摘要等多种方式确保用户敏感信息的安全。

- 文件传输接口

  文件传输接口的功能实际上仍然是对数据进行读写操作，从这个角度来看，文件传输接口与上述接口无异。但是，为了使文件对应的二进制流能够顺利保存到前端或服务器上，前后端需要共同遵循更为严格的接口规范。其中，主要的措施有：对于可以被公开获取的文件（以头像、竞赛宣传图等图片数据为主），采用直接返回对应文件地址的方式完成数据传输，减少身份认证的环节，提高加载速度，优化用户体验。而对于一些需要验证身份才能获取的文件（如竞赛成绩单、证书、用户提交的参赛作品等），则需要由前端发送带有身份凭证的请求给后端，后端通过身份验证后，再利用Nginx的代理，动态返回文件流。既保障了用户文件的安全，也避免了盗链等现象的发生。



## 五、重难点问题及其解决办法

### 1、前端部分

#### 复杂页面的设计

- 在线编辑成绩
- 竞赛修改
- 用户友好的查找队友功能
- Add more

#### TODO: Add more



## 六、产品特色与亮点

### 用户友好的UI设计

- （如多种提示信息的显示方式、页面布局及文本提示、合理的组件选用）

### 适配多种使用情境

- 电脑端、平板端、手机端、微信小程序端
- 无需注册也可以快捷体验的功能

### 完整便捷的功能体验

- 如竞赛全流程的一站式服务（从发布到获奖信息验证），学习成本低

